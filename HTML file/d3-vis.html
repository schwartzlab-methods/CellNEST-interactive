<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>D3 Vis</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="//unpkg.com/3d-force-graph"></script>
    <script src="//unpkg.com/three"></script>
    <script
      scr="https://unpkg.com/three/examples/jsm/renderers/CSS2DRenderer.js"
    ></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="d3-vis.css" />
  </head>
  <body>
    <div class="ml-4 my-8 w-11/12">
      <h1 class="text-3xl py-5">NEST Interactive</h1>
      <div>
        <label for="edge_count" class="text-base font-bold mb-2 py-2"
          >Edge count:</label
        >
        <input
          type="number"
          id="edge_count"
          name="edge_count"
          value="1300"
          class="shadow appearance-none border rounded py-2 px-3"
        />
      </div>
      <div class="pt-3 block">
        <label
          for="background_colour_picker"
          class="text-base font-bold mb-2 py-2"
          >Background Colour Picker:</label
        >
        <input
          type="color"
          id="background_colour_picker"
          name="background_colour_picker"
          class="p-1 h-10 w-14 bg-white border border-gray-200 cursor-pointer w-10 rounded-lg"
          value="#f4f5de"
          title="Choose your color"
        />
      </div>
      <div class="pt-3 block">
        <label
          for="background_colour_picker"
          class="text-base font-bold mb-2 py-2"
          >Change Colour:</label
        >
        <input
          type="number"
          id="component_input"
          name="component_input"
          value=""
          class="shadow appearance-none border rounded py-2 px-3"
        />
        <input
          type="color"
          id="colour_picker"
          name="colour_picker"
          class="p-1 h-10 w-14 bg-white border border-gray-200 cursor-pointer w-10 rounded-lg"
          value="#f4f5de"
          title="Choose your color"
        />
        <button
          class="shadow appearance-none border bg-blue-200 rounded py-2 px-3"
          id="colour_change_button"
        >
          <p class="w-full text-center">Change</p>
        </button>
      </div>
      <div class="mt-3">
        <label for="gene_or_connection" class="text-base font-bold"
          >Gene/Connection search:</label
        >
      </div>
      <div>
        <div id="search_div" class="w-full h-auto mb-3">
          <div class="relative mt-1">
            <div
              class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none"
            >
              <svg
                class="w-4 h-4 text-gray-500 dark:text-gray-400"
                aria-hidden="true"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 20 20"
              >
                <path
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"
                />
              </svg>
            </div>
            <div class="w-full">
              <input
                type="text"
                id="gene_or_connection"
                name="gene_or_connection"
                class="shadow appearance-none border rounded pl-10 py-2 px-3"
              />
              <button
                class="shadow appearance-none border bg-blue-200 rounded py-2 px-3"
                id="reset_search"
              >
                <p class="w-full text-center">Reset</p>
              </button>
            </div>
          </div>
          <div
            id="gene_or_connection_results"
            class="absolute overflow-auto w-11/12 max-h-40 bg-white divide-y divide-black-100 rounded-lg shadow results"
            style="z-index: 1"
          ></div>
        </div>
      </div>
      <!--<div id="graph"></div>-->
      <div id="graph-3d" class="border-solid"></div>
      <div id="histogram" class="mt-5"></div>
    </div>
    <script type="module">
      import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm";
      import { callBackend } from "./modules/backend.js";
      import { load3D } from "./modules/3d.js";
      import { fuzzySearch } from "./modules/fuzzysearch.js";
      import {
        graph3D,
        setSvg,
        setElement3D,
        setLastFilter,
      } from "./globalvars.js";
      window.onload = function () {
        const margin = { top: 10, right: 10, bottom: 10, left: 10 };
        const width = 1000 - margin.left - margin.right;
        const height = 700 - margin.top - margin.bottom;
        setSvg(
          d3
            .select("#graph")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .style("border-style", "solid")
        );
        setElement3D(document.getElementById("graph-3d"));
        callBackend(1300);
        setLastFilter(undefined);
      };
      fuzzySearch;

      document.querySelector("#edge_count").addEventListener("change", (e) => {
        callBackend(e.target.value);
      });

      document
        .querySelector("#background_colour_picker")
        .addEventListener("change", (e) => {
          graph3D.backgroundColor(e.target.value);
        });

      document
        .querySelector("#colour_change_button")
        .addEventListener("click", (e) => {
          load3D({
            type: "colour",
            data: [
              document.getElementById("component_input").value,
              document.getElementById("colour_picker").value,
            ],
          });
        });

      document.querySelector("#reset_search").addEventListener("click", (e) => {
        document.querySelector("#gene_or_connection").value = "";
        document.querySelector("#gene_or_connection_results").innerHTML = "";
        callBackend(1300);
        setLastFilter(undefined);
      });

      document
        .getElementById("gene_or_connection")
        .addEventListener("click", (e) => {
          var results = document.getElementById("gene_or_connection_results");
          if (!results.classList.contains("show")) {
            results.classList.add("show");
          }
        });

      window.onclick = function (event) {
        if (!(event.target.id == "gene_or_connection")) {
          var results = document.getElementById("gene_or_connection_results");
          if (results.classList.contains("show")) {
            results.classList.remove("show");
          }
        }
      };
    </script>
  </body>
</html>
